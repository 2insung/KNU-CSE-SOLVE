<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{GeneralLayout}">
<head>
    <link rel="stylesheet" th:href="@{/css/PostPage.css}"/>
    <link rel="stylesheet" th:href="@{/css/PostPreviewList.css}"/>
</head>
<th:block layout:fragment="contentFragment">
    <div class="post">
        <div class="board-header">
            <div class="board-alias">
                <a th:href="@{/board/{boardType}(boardType=${board.type})}" th:text="${board.alias}"></a>
            </div>
        </div>
        <div class="post-header">
            <div class="post-title" th:text="${post.title}"></div>
            <div class="post-author-wrapper">
                <div class="post-author-image">
                    <img th:src="${post.authorProfileImage != null ? post.authorProfileImage : '/img/tempProfile.jpg'}">
                </div>
                <div class="post-author-nickname">
                    <a th:href="@{/my/{nickname}(nickname=${post.authorNickname})}"
                       th:text="${post.authorNickname}"></a>
                </div>
            </div>

            <div class="post-info-wrapper">
                <div class="time">
                    <span th:text="${post.createdAt}"></span>
                    <span th:text="'(수정 : ' + ${post.updatedAt} + ')'"></span>
                </div>
                <div class="count">
                    <span th:text="'조회수 ' + ${post.hitCount}"></span>
                    <span th:text="'추천수 ' + ${post.recommendCount}"></span>
                    <span th:text="'댓글수 ' + ${post.commentCount}"></span>
                </div>
            </div>
        </div>
        <div class="post-option-wrapper">
            <div class="post-rewrite-button" th:if="${post.isMine}">
                <a th:href="@{/rewrite/{postAuthor}/{boardType}/{postId}(postAuthor=${post.authorNickname},boardType=${board.type},postId=${postId})}">
                    수정
                </a>
            </div>
            <button class="post-delete-button"
                    th:if="${post.isMine}"
                    th:data-boardType="${board.type}"
                    th:data-postAuthor="${post.authorNickname}"
                    th:data-postId="${post.postId}"
                    onclick="deletePost(this.getAttribute('data-boardType'), this.getAttribute('data-postAuthor'), this.getAttribute('data-postId'))">
                삭제
            </button>
        </div>
        <div class="post-body-wrapper">
            <div class="post-body" th:utext="${post.body}"></div>
            <div class="post-recommend">
                <div class="post-recommend-image">
                    <img src="/img/thumb.png">
                </div>
                <div class="post-recommend-count">
                    <span id="postRecommendCount" th:text="${post.recommendCount}"></span>
                </div>
            </div>
        </div>
        <div id="commentFragment">
            <div class="comment-list-wrapper">
                <div class="comment-count">
                    <span th:text="'댓글수 ' + ${commentCount}"></span>
                </div>
                <ul th:each="comment : ${commentList}">
                    <li class="deleted-comment" th:if="${comment.isDeleted}">
                        삭제된 댓글입니다.
                    </li>
                    <li th:unless="${comment.isDeleted}">
                        <div th:class="${comment.isRoot ? 'root-comment-wrapper' : 'child-comment-wrapper'}">
                            <div class="comment-header">
                                <div class="comment-author-wrapper">
                                    <div class="comment-author-image">
                                        <img th:src="${comment.authorProfileImage != null ? comment.authorProfileImage : '/img/tempProfile.jpg'}">
                                    </div>
                                    <div class="comment-author-nickname">
                                        <a th:href="@{/my/{nickname}(nickname=${comment.authorNickname})}"
                                           th:text="${comment.authorNickname}"></a>
                                    </div>
                                    <div class="post-author" th:if="${comment.isPostAuthor}">
                                        작성자
                                    </div>
                                </div>
                                <div class="comment-button-wrapper">
                                    <button type="button"
                                            class="delete-comment-button"
                                            th:if="${comment.isMine}"
                                            th:data-commentAuthor="${comment.authorNickname}"
                                            th:data-commentId="${comment.commentId}"
                                            th:data-postId="${comment.postId}"
                                            th:data-currentPageNumber="${commentPageNumber}"
                                            onclick="
                                                deleteComment(
                                                    this.getAttribute('data-commentAuthor'),
                                                    this.getAttribute('data-commentId'),
                                                    this.getAttribute('data-postId'),
                                                    this.getAttribute('data-currentPageNumber')
                                                )"
                                    >삭제
                                    </button>
                                    <button type="button"
                                            class="show-form-button"
                                            onclick="showForm(this)">
                                        대댓글
                                    </button>
                                </div>
                            </div>
                            <div class="comment-body-wrapper">
                                <div class="parent-author"
                                     th:if="${comment.isRoot == false && comment.isRootChild == false}"
                                     th:text="${comment.parentAuthorNickname}"
                                ></div>
                                <div class="comment-body" th:text="${comment.body}"></div>
                            </div>
                            <div class="comment-time-wrapper">
                                <div class="comment-created-at"
                                     th:text="${comment.createdAt}"
                                ></div>
                            </div>
                        </div>
                        <form id="childCommentForm" class="child-comment-form" style="display: none;">
                            <textarea class="comment-input" th:id="'childContent-' + ${comment.commentId}"
                                      name="body"></textarea>
                            <div class="submit-button-wrapper">
                                <button type="button"
                                        th:data-commentId="${comment.commentId}"
                                        th:data-postId="${comment.postId}"
                                        th:data-currentPageNumber="${commentPageNumber}"
                                        onclick="saveChildComment(this.getAttribute('data-commentId'), this.getAttribute('data-postId'), this.getAttribute('data-currentPageNumber'))">
                                    입력
                                </button>
                            </div>
                        </form>
                    </li>
                </ul>
                <div class="comment-page-number-list-wrapper">
                    <button th:if="${commentPrevPageNumber != null}"
                            th:data-postId="${postId}"
                            th:data-prevPageNumber="${commentPrevPageNumber}"
                            onclick="readComment(this.getAttribute('data-postId'), this.getAttribute('data-prevPageNumber'))">
                        <div class="comment-arrow-left">◀</div>
                    </button>
                    <ul th:each="number : ${commentPageNumberList}">
                        <li th:class="${number == commentPageNumber} ? 'comment-active-page-number' : 'comment-page-number'"
                            th:text="${number}"
                            th:data-postId="${postId}"
                            th:data-pageNumber="${number}"
                            onclick="readComment(this.getAttribute('data-postId'), this.getAttribute('data-pageNumber'))">
                        </li>
                    </ul>
                    <button th:if="${commentNextPageNumber != null}"
                            th:data-postId="${postId}"
                            th:data-nextPageNumber="${commentNextPageNumber}"
                            onclick="readComment(this.getAttribute('data-postId'), this.getAttribute('data-nextPageNumber'))">
                        <div class="comment-arrow-right">▶</div>
                    </button>
                </div>
                <form id="rootCommentForm" class="root-comment-form">
                    <textarea id="rootContent" class="comment-input" name="body"></textarea>
                    <div class="submit-button-wrapper">
                        <button type="button"
                                class="submit-button"
                                th:data-postId="${postId}"
                                onclick="saveRootComment(this.getAttribute('data-postId'))">입력
                        </button>
                    </div>
                </form>
            </div>
        </div>
        <th:block th:replace="PostPreviewList :: postPreviewListFragment"></th:block>
    </div>
</th:block>
<th:block layout:fragment="scriptFragment">
    <script th:src="@{/js/PostPage.js}"></script>
</th:block>
</html>